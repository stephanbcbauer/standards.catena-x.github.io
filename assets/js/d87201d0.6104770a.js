"use strict";(self.webpackChunkcatenax_ng=self.webpackChunkcatenax_ng||[]).push([[3687],{6643:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>c,frontMatter:()=>s,metadata:()=>a,toc:()=>p});var i=n(5893),o=n(1151);const s={title:"How to setup GitHub apps"},r=void 0,a={id:"internal/how-to-setup-apps",title:"How to setup GitHub apps",description:"This guide is only for those who operate the environment",source:"@site/docs/internal/how-to-setup-apps.md",sourceDirName:"internal",slug:"/internal/how-to-setup-apps",permalink:"/docs/internal/how-to-setup-apps",draft:!1,unlisted:!1,editUrl:"https://github.com/catenax-ng/catenax-ng.github.io/edit/main/docs/internal/how-to-setup-apps.md",tags:[],version:"current",frontMatter:{title:"How to setup GitHub apps"},sidebar:"tutorialSidebar",previous:{title:"How to setup and AKS cluster via terraform",permalink:"/docs/internal/how-to-setup-aks-cluster-via-terraform"},next:{title:"How to manage forked repositories from eclipse-tractusx",permalink:"/docs/internal/how-to-setup-forked-repo"}},d={},p=[{value:"Context",id:"context",level:2},{value:"Create GitHub App",id:"create-github-app",level:2},{value:"General",id:"general",level:2},{value:"Permissions &amp; events",id:"permissions--events",level:2},{value:"Install App",id:"install-app",level:2},{value:"Additions for the source repository workflow",id:"additions-for-the-source-repository-workflow",level:2},{value:"Additions for the target repository workflow",id:"additions-for-the-target-repository-workflow",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsx)(t.p,{children:"This guide is only for those who operate the environment"})}),"\n",(0,i.jsx)(t.p,{children:"This how-to will guide you through the deployment and configuration of GitHub Apps"}),"\n",(0,i.jsx)(t.h2,{id:"context",children:"Context"}),"\n",(0,i.jsx)(t.p,{children:"As users don't have admin rights on repositories, they can't trigger actions in other repositories. They could use their PATs, but this is seen as bad practice. But as this got requested more often, we set up GitHub Apps which act like a technical user."}),"\n",(0,i.jsx)(t.p,{children:"In this document the source repository is referring to the repository from which an action is initiated, whereas the target repository will be the one where the actions will be called."}),"\n",(0,i.jsx)(t.h2,{id:"create-github-app",children:"Create GitHub App"}),"\n",(0,i.jsxs)(t.p,{children:["To create an app follow the offical guide ",(0,i.jsx)(t.a,{href:"https://docs.github.com/en/developers/apps/building-github-apps/creating-a-github-app",children:"here"})]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Callback URL needs to be filled out, we just use the standard catena homepage link"}),"\n",(0,i.jsx)(t.li,{children:"As we just use a basic setup, options like the webhook URL and device workflow don't need to be configured."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"The app then needs to be configured within the organization menu:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Administration",src:n(1612).Z+"",width:"1282",height:"1141"})}),"\n",(0,i.jsx)(t.p,{children:"The individual configuration is described below."}),"\n",(0,i.jsx)(t.h2,{id:"general",children:"General"}),"\n",(0,i.jsx)(t.p,{children:"From this menu one needs the app ID:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Administration",src:n(7017).Z+"",width:"1041",height:"213"})}),"\n",(0,i.jsx)(t.p,{children:"Further below a private key needs to be created (You need to download it):"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Administration",src:n(3519).Z+"",width:"844",height:"312"})}),"\n",(0,i.jsx)(t.p,{children:"These settings (app ID and private key) need to be stored as secrets, as the users will can use them in their actions/workflows:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Administration",src:n(8225).Z+"",width:"1252",height:"757"})}),"\n",(0,i.jsx)(t.p,{children:"In this example PORTAL is the product name:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"ORG_PORTAL_DISPATCH_APPID -> app ID from above"}),"\n",(0,i.jsx)(t.li,{children:"ORG_PORTAL_DISPATCH_KEY -> content of private key file"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"When creating the secret, set the scope (=permissions to the source repository)"}),"\n",(0,i.jsx)(t.h2,{id:"permissions--events",children:"Permissions & events"}),"\n",(0,i.jsx)(t.p,{children:"Here only permission for actions need to be set to read and write"}),"\n",(0,i.jsx)(t.h2,{id:"install-app",children:"Install App"}),"\n",(0,i.jsx)(t.p,{children:"Here you need to choose all source and target repositories"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Administration",src:n(7054).Z+"",width:"1056",height:"866"})}),"\n",(0,i.jsx)(t.h2,{id:"additions-for-the-source-repository-workflow",children:"Additions for the source repository workflow"}),"\n",(0,i.jsx)(t.p,{children:"The products need to add the following steps to their calling action:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'steps:\n- name: Get Token\n  id: get_workflow_token\n  uses: peter-murray/workflow-application-token-action@v1\n  with:\n    application_id: ${{ secrets.ORG_REPO_DISPATCH_APPID }}\n    application_private_key: ${{ secrets.ORG_REPO_DISPATCH_KEY }}      \n- name: trigger-workflow\n  id: call_action\n  env:\n    TOKEN: ${{ steps.get_workflow_token.outputs.token }}\n  run: |\n    curl -v \\\n      --request POST \\\n      --url https://api.github.com/repos/catenax-ng/playground-target/actions/workflows/example.yaml/dispatches \\\n      --header "authorization: Bearer $TOKEN" \\\n      --header "Accept: application/vnd.github.v3+json" \\\n      --data \'{"ref":"test_branch","inputs":{"any_data":"anything","any_data2":"anything2"}}\' \\\n      --fail\n'})}),"\n",(0,i.jsx)(t.h2,{id:"additions-for-the-target-repository-workflow",children:"Additions for the target repository workflow"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'name: Demo\non: \n  workflow_dispatch:\n    inputs:\n    # any parameter used in calling workflow needs to be declared here\n    # setting required to false means it\'s an optional parameter\n      any_data:\n        description: "content here"\n        required: true\n        default: "no content"\n      any_data2:\n        description: "more data"\n        required: false\n        default: "no content"\njobs:\n  show_workspace:\n    runs-on: ubuntu-latest\n    steps:\n      - run: echo "event payload ${{ github.event.inputs.any_data }}"\n'})})]})}function c(e={}){const{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},1612:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/app1-35d24b2eb258e66cb5dd75266e525de7.png"},7017:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/app2-b1a6593ec70718775dfdd249e6c8bd4f.png"},3519:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/app3-ba9ff71b0a61229fc7166bd44cd94291.png"},8225:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/app4-731def333a2638e3fe3af9d3f48500cb.png"},7054:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/app5-96b88eeaa310ff6748f88abf6838898c.png"},1151:(e,t,n)=>{n.d(t,{Z:()=>a,a:()=>r});var i=n(7294);const o={},s=i.createContext(o);function r(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);