"use strict";(self.webpackChunkcatenax_ng=self.webpackChunkcatenax_ng||[]).push([[8309],{2550:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>c,frontMatter:()=>t,metadata:()=>o,toc:()=>h});var i=l(5893),a=l(1151);const t={title:"How To Use Vault Secrets With ArgoCD"},s=void 0,o={id:"guides/ArgoCD/howto-use-vault-secrets-with-argocd",title:"How To Use Vault Secrets With ArgoCD",description:"This guide is a small how-to about using secrets stored in HashiCorp Vault with your ArgoCD applications (with Helm",source:"@site/docs/guides/ArgoCD/howto-use-vault-secrets-with-argocd.md",sourceDirName:"guides/ArgoCD",slug:"/guides/ArgoCD/howto-use-vault-secrets-with-argocd",permalink:"/docs/guides/ArgoCD/howto-use-vault-secrets-with-argocd",draft:!1,unlisted:!1,editUrl:"https://github.com/catenax-ng/catenax-ng.github.io/edit/main/docs/guides/ArgoCD/howto-use-vault-secrets-with-argocd.md",tags:[],version:"current",frontMatter:{title:"How To Use Vault Secrets With ArgoCD"},sidebar:"tutorialSidebar",previous:{title:"How to deploy an application on 'Hotel Budapest'",permalink:"/docs/guides/ArgoCD/how-to-deploy-an-application"},next:{title:"Helm Chart",permalink:"/docs/guides/Helm/helmchart"}},r={},h=[{value:"Add Placeholder To Your Code",id:"add-placeholder-to-your-code",level:2},{value:"Examples",id:"examples",level:3},{value:"Configure The ArgoCD App To Use AVP",id:"configure-the-argocd-app-to-use-avp",level:2},{value:"Use multiple helm values file when using AVP",id:"use-multiple-helm-values-file-when-using-avp",level:3},{value:"Available ArgoCD Vault Plugins",id:"available-argocd-vault-plugins",level:2},{value:"<em>argocd-vault-plugin</em>",id:"argocd-vault-plugin",level:3},{value:"<em>argocd-vault-plugin-helm</em>",id:"argocd-vault-plugin-helm",level:3},{value:"<em>argocd-vault-plugin-helm-args</em>",id:"argocd-vault-plugin-helm-args",level:3},{value:"<em>argocd-vault-plugin-kustomize</em>",id:"argocd-vault-plugin-kustomize",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"This guide is a small how-to about using secrets stored in HashiCorp Vault with your ArgoCD applications (with Helm\ncharts or Kustomize)."}),"\n",(0,i.jsxs)(n.admonition,{title:"tl;dr",type:"info",children:[(0,i.jsx)(n.p,{children:"To use vault secrets with your ArgoCD app, you have to"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"store your secret inside your Vault tenant"}),"\n",(0,i.jsx)(n.li,{children:"insert placeholders to app dependent files (ArgoCD App, helm, Kustomize, etc.)"}),"\n",(0,i.jsxs)(n.li,{children:["configure your ArgoCD application to use an ArgoCD Vault Plugin (AVP) using the ",(0,i.jsx)(n.em,{children:"vault-secret"})]}),"\n"]}),(0,i.jsxs)(n.p,{children:["For guidance of how to use Vault and store a secret inside Vault, please refer to\n",(0,i.jsx)(n.a,{href:"/docs/guides/how-to-use-vault",children:"How To Use Vault"}),"."]})]}),"\n",(0,i.jsx)(n.h2,{id:"add-placeholder-to-your-code",children:"Add Placeholder To Your Code"}),"\n",(0,i.jsx)(n.p,{children:"The AVP plugin use placeholders to recognize where you want to place a Vault secret value inside your code. Example\nplaceholder:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"<placeholder>"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"<path:some/path#secret-key>"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"<path:some/path#secret-key#version>"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The secret path can alternatively be defined as annotation in manifest files instead of inside the placeholder."}),"\n",(0,i.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(n.p,{children:"Placeholder with inline path:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: avp-example-secret\ntype: Opaque\nstringData:\n  //highlight-next-line\n  foo: <path:product-team-example/data/hello#foo>\n"})}),"\n",(0,i.jsx)(n.p,{children:"Placeholder and annotation for secret path:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Secret\nmetadata:\n  name: avp-example-secret\n  annotations:\n  //highlight-next-line\n  avp.kubernetes.io/path: "product-team-example/data/hello"\ntype: Opaque\nstringData:\n  //highlight-next-line\n  foo: <foo>\n'})}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"When using annotation to specify the path to the secret inside vault, the placeholder represents only the key inside the\nsecret."}),(0,i.jsx)(n.p,{children:"If you're using secrets from different paths within one file you must use placeholder with inline path definition, as\nonly one secret path can be provided by annotation."}),(0,i.jsxs)(n.p,{children:["Please keep in mind that the path must contain ",(0,i.jsx)(n.em,{children:"data"})," (e.g. ",(0,i.jsx)(n.code,{children:"product-team-example/data/hello"}),") otherwise you'll get an\nerror message about ",(0,i.jsx)(n.em,{children:"secret not found"})," or similar."]})]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"As this project will be released with an open source scope, it is recommended to use placeholders with the inline path definition (as shown in example #1 above). When users want to install your stuff, it's not guaranteed that they're using ArgoCD with Vault plugin as we do (thus keeping it the most generic way possible)."})}),"\n",(0,i.jsxs)(n.p,{children:["You are not limited to use these placeholders inside manifest files, you can also use these inside helm specific file\nlike ",(0,i.jsx)(n.code,{children:"values.yaml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"avp:\n  helm:\n    secretPath: <path:product-team-example/data/hello#foo>\n"})}),"\n",(0,i.jsx)(n.p,{children:"And inside e.g. the helm templates you can reference like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: avp-example-path-secret\ntype: Opaque\nstringData:\n  foo: { { .Values.avp.helm.secretPath } }\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["Additional information about replacement behavior, placeholder types and more can be found\nin ",(0,i.jsx)(n.a,{href:"https://argocd-vault-plugin.readthedocs.io/en/stable/howitworks/",children:"ArgoCD Vault Plugin Documentation"}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"configure-the-argocd-app-to-use-avp",children:"Configure The ArgoCD App To Use AVP"}),"\n",(0,i.jsx)(n.p,{children:"To enable your ArgoCD app to use the AVP plugin there is a mandatory step required:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Configure the app to use one of the available AVP plugins"}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"Your Vault Secret",type:"info",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.em,{children:"vault-secret"})," has been created for each product-team during onboarding."]})}),"\n",(0,i.jsx)(n.p,{children:"In general your ArgoCD app manifest should look like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: argoproj.io/v1alpha1\nkind: Application\nmetadata:\n  name: my-argo-app\nspec:\n  project: project-name\n  destination:\n    server: https://kubernetes.default.svc\n    namespace: project-name\n  source:\n    repoURL: https://github.com/catenax-ng/someRepo/\n    targetRevision: HEAD\n    path: path/to/app\n    // highlight-getstarted\n    plugin:\n      name: argocd-vault-plugin\n    // highlight-end\n"})}),"\n",(0,i.jsxs)(n.p,{children:["To configure your ArgoCD application to use an AVP plugin using the ArgoCD Web UI after the ",(0,i.jsx)(n.em,{children:"Destination"})," section you\nhave to select ",(0,i.jsx)(n.em,{children:"Plugin"})," from the dropdown selector, select the appropriate AVP plugin and enter the secret information:"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Select Plugin",src:l(8717).Z+"",title:"Select Plugin",width:"958",height:"674"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"AVP configuration",src:l(8872).Z+"",title:"AVP configuration",width:"816",height:"556"})}),"\n",(0,i.jsx)(n.h3,{id:"use-multiple-helm-values-file-when-using-avp",children:"Use multiple helm values file when using AVP"}),"\n",(0,i.jsxs)(n.p,{children:["Please read here if your application is using helm chart. If you use not only default ",(0,i.jsx)(n.code,{children:"values.yaml"}),", but also provide an\nadditional value file. The priority will be given to the last (right-most) file specified. (see: ",(0,i.jsx)(n.a,{href:"https://helm.sh/docs/helm/helm_install/",children:"Helm Documentation"}),") Please use vault plugin ",(0,i.jsx)(n.code,{children:"argocd-vault-plugin-helm-args"})," and configure it like the example:"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Multiple Helm values",src:l(2445).Z+"",title:"AVP configuration",width:"848",height:"242"})}),"\n",(0,i.jsxs)(n.p,{children:["To configure multiple ",(0,i.jsx)(n.code,{children:"values.yaml"})," in App manifest, please refer\nto ",(0,i.jsx)(n.a,{href:"#argocd-vault-plugin-helm-args",children:"argocd-vault-plugin-helm-args"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"available-argocd-vault-plugins",children:"Available ArgoCD Vault Plugins"}),"\n",(0,i.jsx)(n.p,{children:"For different approaches there are different ArgoCD Vault Plugins (AVP) available:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.em,{children:"argocd-vault-plugin"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.em,{children:"argocd-vault-plugin-helm"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.em,{children:"argocd-vault-plugin-helm-args"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.em,{children:"argocd-vault-plugin-kustomize"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"argocd-vault-plugin",children:(0,i.jsx)(n.em,{children:"argocd-vault-plugin"})}),"\n",(0,i.jsx)(n.p,{children:"Use this AVP plugin when your ArgoCD app is based on plain Kubernetes manifest files, and you want to pull secrets from\nvault into your app."}),"\n",(0,i.jsx)(n.p,{children:"The App manifest should contain:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"  plugin:\n    //highlight-next-line\n    name: argocd-vault-plugin\n"})}),"\n",(0,i.jsx)(n.h3,{id:"argocd-vault-plugin-helm",children:(0,i.jsx)(n.em,{children:"argocd-vault-plugin-helm"})}),"\n",(0,i.jsx)(n.p,{children:"Use this AVP plugin when your ArgoCD app is based on helm charts, and you want to pull secrets from vault into your app."}),"\n",(0,i.jsx)(n.p,{children:"The App manifest should contain:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"  plugin:\n    //highlight-next-line\n    name: argocd-vault-plugin-helm\n"})}),"\n",(0,i.jsx)(n.h3,{id:"argocd-vault-plugin-helm-args",children:(0,i.jsx)(n.em,{children:"argocd-vault-plugin-helm-args"})}),"\n",(0,i.jsxs)(n.p,{children:["Use this AVP plugin when your ArgoCD app is based on helm charts, but you have e.g. environment\nspecific ",(0,i.jsx)(n.code,{children:"values-env.yaml"})," files to apply, and you want to pull secrets from vault into your app."]}),"\n",(0,i.jsx)(n.p,{children:"The App manifest should contain:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"  plugin:\n    //highlight-next-line\n    name: argocd-vault-plugin-helm-args\n    env:\n      //highlight-getstarted\n      - name: helm_args\n        value: '-f values.yaml -f values-env.yaml'\n      //highlight-end\n"})}),"\n",(0,i.jsx)(n.h3,{id:"argocd-vault-plugin-kustomize",children:(0,i.jsx)(n.em,{children:"argocd-vault-plugin-kustomize"})}),"\n",(0,i.jsx)(n.p,{children:"Use this AVP plugin when your ArgoCD app is based on plain Kubernetes manifest files, and you want to pull secrets from\nvault into your app."}),"\n",(0,i.jsx)(n.p,{children:"The App manifest should contain:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"  plugin:\n    //highlight-next-line\n    name: argocd-vault-plugin-kustomize\n"})})]})}function c(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8717:(e,n,l)=>{l.d(n,{Z:()=>i});const i=l.p+"assets/images/avp_plugin_webui1-a1db77ad7550dd0a1890af5eb8e8e32e.png"},8872:(e,n,l)=>{l.d(n,{Z:()=>i});const i=l.p+"assets/images/avp_plugin_webui2-6e5e49e7ef891437f512b4e9540d9b24.png"},2445:(e,n,l)=>{l.d(n,{Z:()=>i});const i=l.p+"assets/images/vault-multiple-helm-values-fca15f4ea52242c6d079d3c2044a3368.png"},1151:(e,n,l)=>{l.d(n,{Z:()=>o,a:()=>s});var i=l(7294);const a={},t=i.createContext(a);function s(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);